<!doctype html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout(~{::content})}">
<div th:fragment="content">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3 mb-0"><i class="bi bi-person-badge me-2"></i>Gestión de Empleados</h1>
    <a class="btn btn-primary" th:href="@{/admin/empleados/nuevo}">Nuevo</a>
  </div>

  <div th:if="${mensaje}"
       th:class="${mensajeTipo} != null ? 'alert alert-dismissible fade show alert-' + mensajeTipo : 'alert alert-dismissible fade show alert-info'"
       role="alert">
    <span th:text="${mensaje}"></span>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
  </div>

  <form class="row g-2 mb-3">
    <div class="col-md-4">
      <input type="text" class="form-control" name="q" placeholder="Buscar por nombre, usuario o documento"
             th:value="${q}">
    </div>
    <div class="col-md-3">
      <select class="form-select" name="tipo">
        <option th:value="''" th:selected="${tipoSeleccionado} == null">Todos los tipos</option>
        <option th:each="t : ${tiposEmpleado}"
                th:value="${t}"
                th:text="${t}"
                th:selected="${tipoSeleccionado} == ${t}"></option>
      </select>
    </div>
    <div class="col-auto">
      <button class="btn btn-outline-secondary">Buscar</button>
    </div>
  </form>

  <div class="table-responsive">
    <table class="table table-striped">
      <thead>
      <tr>
        <th>Apellido, Nombre</th>
        <th>Usuario</th>
        <th>Tipo</th>
        <th>Sucursal</th>
        <th>Teléfono</th>
        <th>Email</th>
        <th>Estado</th>
        <th class="text-end"></th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="emp : ${empleados}">
        <td th:text="${emp.nombreCompleto}"></td>
        <td th:text="${emp.nombreUsuario}"></td>
        <td th:text="${emp.tipo}"></td>
        <td th:text="${emp.sucursalNombre}"></td>
        <td th:text="${emp.telefono}"></td>
        <td th:text="${emp.correoElectronico}"></td>
        <td>
          <span th:if="${emp.activo}" class="badge text-bg-success">Activo</span>
          <span th:if="${!emp.activo}" class="badge text-bg-secondary">Inactivo</span>
        </td>
        <td class="text-end">
          <a class="btn btn-sm btn-outline-primary"
             th:href="@{|/admin/empleados/${emp.id}/editar|}">Editar</a>
          <form th:action="@{|/admin/empleados/${emp.id}/estado|}" method="post" class="d-inline">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
            <input type="hidden" name="activo" th:value="${!emp.activo}">
            <button class="btn btn-sm"
                    th:classappend="${emp.activo} ? ' btn-outline-warning' : ' btn-outline-success'"
                    th:text="${emp.activo} ? 'Desactivar' : 'Activar'"
                    th:onclick="${emp.activo} ? 'return confirm(\'¿Seguro que deseas desactivar al empleado?\')' : null"></button>
          </form>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</div>
</html>
