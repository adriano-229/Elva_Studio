<!DOCTYPE html>
<html th:replace="~{fragments/layout :: layout(~{::title}, ~{::div})}"
      xmlns:th="http://www.thymeleaf.org"
>
<head>
  <title>Migración de Proveedores - TP1</title>
</head>
<body>
<div>
  <h1 class="mt-4">Migración de Proveedores</h1>
  <ol class="breadcrumb mb-4">
    <li class="breadcrumb-item"><a th:href="@{/}">Inicio</a></li>
    <li class="breadcrumb-item"><a th:href="@{/proveedores}">Proveedores</a></li>
    <li class="breadcrumb-item active">Migración</li>
  </ol>

  <!-- Mensajes de Error/Éxito -->
  <div class="alert alert-danger alert-dismissible fade show" role="alert" th:if="${error}">
    <i class="fas fa-exclamation-triangle me-2"></i>
    <strong>Error:</strong> <span th:text="${error}"></span>
    <button aria-label="Close" class="btn-close" data-bs-dismiss="alert" type="button"></button>
  </div>

  <!-- Resultados de la Migración -->
  <div class="card mb-4 border-success" th:if="${exito}">
    <div class="card-header bg-success text-white">
      <i class="fas fa-check-circle me-2"></i>Migración Completada
    </div>
    <div class="card-body">
      <h5 class="card-title">Resumen de la migración:</h5>

      <!-- Estadísticas Generales -->
      <div class="row mb-3">
        <div class="col-md-6">
          <div class="card bg-light">
            <div class="card-body">
              <h6 class="card-subtitle mb-2 text-muted">Proveedores</h6>
              <p class="mb-1">Total inicial: <strong th:text="${resultado.totalProveedoresIniciales}">0</strong></p>
              <p class="mb-0 text-success">Añadidos: <strong th:text="${resultado.proveedoresAnadidos}">0</strong></p>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card bg-light">
            <div class="card-body">
              <h6 class="card-subtitle mb-2 text-muted">Personas creadas</h6>
              <p class="mb-0"><strong th:text="${resultado.personasCreadas}">0</strong></p>
            </div>
          </div>
        </div>
      </div>

      <!-- Entidades de Ubicación Creadas -->
      <h6 class="mt-4">Entidades de ubicación creadas:</h6>
      <div class="row">
        <div class="col-md-3">
          <div class="card text-center">
            <div class="card-body">
              <i class="fas fa-globe fa-2x text-primary mb-2"></i>
              <h4 th:text="${resultado.paisesCreados}">0</h4>
              <p class="mb-0 small">Países</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-center">
            <div class="card-body">
              <i class="fas fa-map fa-2x text-info mb-2"></i>
              <h4 th:text="${resultado.provinciasCreadas}">0</h4>
              <p class="mb-0 small">Provincias</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-center">
            <div class="card-body">
              <i class="fas fa-map-marker-alt fa-2x text-warning mb-2"></i>
              <h4 th:text="${resultado.departamentosCreados}">0</h4>
              <p class="mb-0 small">Departamentos</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-center">
            <div class="card-body">
              <i class="fas fa-location-dot fa-2x text-success mb-2"></i>
              <h4 th:text="${resultado.direccionesCreadas}">0</h4>
              <p class="mb-0 small">Direcciones</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Errores Encontrados -->
      <div class="mt-4" th:if="${!resultado.errores.isEmpty()}">
        <h6 class="text-danger">
          <i class="fas fa-exclamation-triangle me-2"></i>
          Errores encontrados (<span th:text="${resultado.errores.size()}">0</span>):
        </h6>
        <div class="table-responsive">
          <table class="table table-striped table-sm">
            <thead>
            <tr>
              <th>Fila</th>
              <th>CUIT</th>
              <th>Motivo</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="error : ${resultado.errores}">
              <td th:text="${error.fila}">1</td>
              <td th:text="${error.cuit}">N/A</td>
              <td th:text="${error.motivo}">Error</td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Sin errores -->
      <div class="alert alert-success mt-4" role="alert" th:if="${resultado.errores.isEmpty()}">
        <i class="fas fa-check-circle me-2"></i>
        ¡No se encontraron errores! Todos los registros se procesaron correctamente.
      </div>

      <!-- Botón para ver proveedores -->
      <div class="mt-4">
        <a class="btn btn-outline-primary" th:href="@{/proveedores}">
          <i class="fas fa-list me-2"></i>Ver todos los proveedores
        </a>
      </div>
    </div>
  </div>

  <!-- Instrucciones -->
  <div class="card mb-4">
    <div class="card-header bg-info text-white">
      <i class="fas fa-info-circle me-2"></i>Instrucciones
    </div>
    <div class="card-body">
      <h5>Formato del archivo:</h5>
      <p>El archivo debe ser un archivo de texto (<code>.txt</code>) con los siguientes campos separados por un
        delimitador (coma, punto y coma, tabulación, etc.):</p>
      <ol>
        <li><strong>Nombre</strong></li>
        <li><strong>Apellido</strong></li>
        <li><strong>Email</strong></li>
        <li><strong>CUIT</strong></li>
        <li><strong>Calle</strong></li>
        <li><strong>Altura</strong></li>
        <li><strong>Departamento</strong></li>
        <li><strong>Código Postal</strong></li>
        <li><strong>Provincia</strong></li>
        <li><strong>País</strong></li>
      </ol>
      <p class="mb-0"><strong>Ejemplo:</strong></p>
      <code>Juan,Pérez,juan@mail.com,20-12345678-9,Av Siempre Viva,742,Springfield,1900,Buenos Aires,Argentina</code>
      <br><br>
      <p class="mb-0 text-muted">
        <i class="fas fa-lightbulb me-1"></i>
        El sistema detectará automáticamente el separador utilizado. Los proveedores duplicados (mismo CUIT y dirección)
        no se volverán a crear.
      </p>
    </div>
  </div>

  <!-- Formulario de Carga -->
  <div class="card mb-4">
    <div class="card-header">
      <i class="fas fa-upload me-2"></i>Cargar Archivo de Proveedores
    </div>
    <div class="card-body">
      <form enctype="multipart/form-data" method="post" th:action="@{/migraciones/proveedores/migrar}">
        <div class="mb-3">
          <label class="form-label" for="archivo">Seleccionar archivo .txt:</label>
          <input accept=".txt" class="form-control" id="archivo" name="archivo" required type="file">
          <div class="form-text">Solo se aceptan archivos de texto (.txt)</div>
        </div>
        <button class="btn btn-primary btn-lg" type="submit">
          <i class="fas fa-file-import me-2"></i>Migrar Proveedores
        </button>
      </form>
    </div>
  </div>

</div>
</body>
</html>
