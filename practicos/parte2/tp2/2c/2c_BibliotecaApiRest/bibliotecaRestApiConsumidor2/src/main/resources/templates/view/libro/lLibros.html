<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Libros</title>

    <!-- Bootstrap CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- FontAwesome CDN -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">

    <style>
        body { background-color: #f8f9fa; }
		.content { padding-top: 20px; }
        .filter-input { max-width: 300px; }
        .table-actions button { margin-right: 5px; }
        .authors-preview { max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    </style>
</head>
<body>
<div class="d-flex">

       <!-- Sidebar -->
       <div th:replace="fragments/sidebar :: sidebar('libros')"></div>

       <!-- Contenido principal -->
       <div class="content flex-grow-1 p-3">
		<div class="container">
		
		    <!-- Título y Crear Libro -->
		    <div class="d-flex justify-content-between align-items-center mb-3">
		        <h2>Libros</h2>
		        <a th:href="@{/libro/crear}" class="btn btn-success">
		            <i class="fa fa-plus"></i> Crear Libro
		        </a>
		    </div>
			
			<!-- Mensajes de éxito o error -->
		    <div th:if="${msgExito}" class="alert alert-success alert-dismissible fade show" role="alert">
		        <i class="fa fa-check-circle"></i>
		        <span th:text="${msgExito}"></span>
		        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
		    </div>
		
		    <div th:if="${msgError}" class="alert alert-danger alert-dismissible fade show" role="alert">
		        <i class="fa fa-exclamation-triangle"></i>
		        <span th:text="${msgError}"></span>
		        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
		    </div>
		
		    <!-- Filtro por Título, Género o Autor -->
		    <form th:action="@{/libro/search}" method="get" class="mb-3 d-flex">
		        <input type="text" name="filtro" class="form-control filter-input" placeholder="Buscar por título, género o autor...">
		        <button type="submit" class="btn btn-primary ms-2">Buscar</button>
		    </form>
		
		    <!-- Tabla de libros -->
		    <div class="table-responsive">
		        <table class="table table-striped table-bordered align-middle">
		            <thead class="table-dark">
		                <tr>
		                    <th>Título</th>
		                    <th>Género</th>
		                    <th>Autores</th>
		                    <th>Acciones</th>
		                </tr>
		            </thead>
		            <tbody>
		                <tr th:each="libro, iterStat : ${lista}">
		                    <td th:text="${libro.titulo}"></td>
		                    <td th:text="${libro.genero}"></td>
		                    <td class="authors-preview">
								<span th:each="autor, stat : ${libro.autores}">
							        <span th:text="${autor.nombre + ' ' + autor.apellido}"></span>
							        <span th:if="${!stat.last}">, </span>
							    </span>
							</td>
		                    <td class="table-actions">
								<!-- Botón Ver (redirige a detallePersona) -->
                                <a th:href="@{'/libro/detalle/' + ${libro.id}}" class="btn btn-info btn-sm">
                                    <i class="fa fa-eye"></i> Ver
                                </a>
		                        <a th:href="@{'/libro/modificar/' + ${libro.id}}" class="btn btn-primary btn-sm">
		                            <i class="fa fa-edit"></i> Modificar
		                        </a>
		                        <a th:href="@{'/libro/eliminar/' + ${libro.id}}" class="btn btn-danger btn-sm">
		                            <i class="fa fa-trash"></i> Eliminar
		                        </a>
		                    </td>
							
							<!-- Modal para autores de cada libro 
			                <div class="modal fade" th:id="'authorsModal__' + ${iterStat.index}" tabindex="-1" aria-hidden="true">
			                  <div class="modal-dialog">
			                    <div class="modal-content">
			                      <div class="modal-header">
			                        <h5 class="modal-title" th:text="'Autores de ' + ${libro.titulo}"></h5>
			                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
			                      </div>
			                      <div class="modal-body">
			                        <ul>
			                            <li th:each="autor : ${libro.autores}" th:text="${autor.nombre + ' ' + autor.apellido}"></li>
			                        </ul>
			                      </div>
			                      <div class="modal-footer">
			                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
			                      </div>
			                    </div>
			                  </div>
			                </div>-->
							
		                </tr>
						<tr th:if="${#lists.isEmpty(lista)}">
		                    <td colspan="4" class="text-center">No hay autores registrados</td>
		                </tr>
		
		            </tbody>
		        </table>
		    </div>
		
		</div>
       </div>
</div>

<!-- Bootstrap JS CDN -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
