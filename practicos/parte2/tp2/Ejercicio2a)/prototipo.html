<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Consultorios — Prototipo Low-Fi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap 5 (sin SRI para evitar errores de integridad) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* Low-fi look: tipografía monoespaciada, líneas y espaciado */
    body { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .rule-line { border-top: 2px dashed #bbb; margin: 1rem 0; }
    .ghost-btn { text-decoration: underline; background: transparent; border: none; padding: 0; }
    .slot-btn { padding: .25rem .5rem; }
    .mini { font-size: .9rem; color:#666; }
    .lofi-card { border: 2px solid #111; border-radius: .5rem; background: #fff; }
    .section-title { font-weight: 700; letter-spacing: .5px; }
    .kpi-badge { border: 1.5px solid #111; background: #f8f9fa; }
    .grid { display:grid; gap:.75rem; }
    .mono-input { font-variant-numeric: tabular-nums; }
    .muted { color:#6c757d; }
  </style>
</head>
<body class="bg-light">

<nav class="navbar bg-white border-bottom sticky-top">
  <div class="container-fluid">
    <span class="navbar-brand fw-bold">Consultorios — Low-Fi</span>
  </div>
</nav>

<div class="bg-white border-bottom">
  <ul class="nav nav-pills container py-2" id="mainTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="tab-buscar" data-bs-toggle="tab" data-bs-target="#buscar" type="button" role="tab" aria-controls="buscar" aria-selected="true">
        A) Buscar/Reservar
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="tab-agenda" data-bs-toggle="tab" data-bs-target="#agenda" type="button" role="tab" aria-controls="agenda" aria-selected="false">
        B) Agenda del Médico
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="tab-caja" data-bs-toggle="tab" data-bs-target="#caja" type="button" role="tab" aria-controls="caja" aria-selected="false">
        C) Caja
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="tab-config" data-bs-toggle="tab" data-bs-target="#config" type="button" role="tab" aria-controls="config" aria-selected="false">
        D) Configurar Agenda
      </button>
    </li>
  </ul>
</div>


<main class="container my-4">
  <div class="tab-content">

    <!-- A) Buscar/Reservar Turno (Paciente) -->
    <section class="tab-pane fade show active" id="buscar">
      <div class="lofi-card p-3">
        <div class="section-title mb-2">A) Buscar/Reservar Turno (Paciente)</div>

        <div class="row g-2 align-items-end">
          <div class="col-12 col-md-3">
            <label class="form-label">Especialidad</label>
            <select id="f-especialidad" class="form-select">
              <option value="">(todas)</option>
              <option>Dermatología</option>
              <option>Clínica</option>
              <option>Cardiología</option>
            </select>
          </div>
          <div class="col-12 col-md-3">
            <label class="form-label">Médico</label>
            <select id="f-medico" class="form-select">
              <option value="">(cualquiera)</option>
              <option>Dr. Pérez</option>
              <option>Dr. Sosa</option>
              <option>Dra. Gómez</option>
            </select>
          </div>
          <div class="col-12 col-md-3">
            <label class="form-label">Fecha desde</label>
            <input id="f-fecha" type="date" class="form-control mono-input">
          </div>
          <div class="col-12 col-md-3 d-grid">
            <button id="btn-buscar" class="btn btn-dark">Buscar</button>
          </div>
        </div>

        <div class="rule-line"></div>

        <div class="mb-2 fw-semibold">Resultados:</div>
        <div id="resultados" class="grid"></div>

        <div class="rule-line"></div>

        <div class="grid">
          <div class="row g-2">
            <div class="col-12 col-md-4">
              <label class="form-label">Paciente</label>
              <input id="paciente-nombre" class="form-control" placeholder="(login / datos rápidos)">
            </div>
            <div class="col-12 col-md-4">
              <label class="form-label">Co-seguro estimado</label>
              <div class="input-group">
                <span class="input-group-text">$</span>
                <input id="coseguro-estimado" class="form-control mono-input" placeholder="____">
              </div>
            </div>
            <div class="col-12 col-md-4 d-flex align-items-end gap-2">
              <button id="btn-ir-resumen" class="btn btn-outline-dark flex-fill" disabled>Seleccionar Slot → Resumen</button>
              <button id="btn-confirmar" class="btn btn-success flex-fill" disabled>Confirmar Reserva</button>
            </div>
          </div>
          <div id="resumen" class="mt-2 mini"></div>
        </div>
      </div>
    </section>

    <!-- B) Agenda del Médico (Hoy) -->
    <section class="tab-pane fade" id="agenda">
      <div class="lofi-card p-3">
        <div class="section-title mb-2">B) Agenda del Médico (Hoy)</div>

        <div class="row g-2 mb-2">
          <div class="col-12 col-md-4">
            <label class="form-label">Médico</label>
            <select id="ag-medico" class="form-select">
              <option>Dr. Pérez</option>
              <option selected>Dr. Sosa</option>
              <option>Dra. Gómez</option>
            </select>
          </div>
          <div class="col-12 col-md-3">
            <label class="form-label">Fecha</label>
            <input id="ag-fecha" type="date" class="form-control mono-input">
          </div>
          <div class="col-12 col-md-3 d-grid">
            <label class="form-label">&nbsp;</label>
            <button id="btn-cargar-agenda" class="btn btn-dark">Cargar Agenda</button>
          </div>
        </div>

        <div class="mb-2 fw-semibold"><span id="ag-header">Dr. Pérez (Lun 18/11) — Consultorio 2</span></div>
        <div id="ag-lista" class="list-group mb-3"></div>

        <div class="d-flex gap-2">
          <span class="badge rounded-pill kpi-badge">Atendidos: <span id="kpi-atendidos">0</span></span>
          <span class="badge rounded-pill kpi-badge">Ausentes: <span id="kpi-ausentes">0</span></span>
          <span class="badge rounded-pill kpi-badge">Pendiente cobro: <span id="kpi-pendientes">0</span></span>
        </div>
      </div>
    </section>

<!-- C) Caja – Cobro Co-seguro -->
<section class="tab-pane fade" id="caja">
  <div class="lofi-card p-3">
    <div class="section-title mb-2">C) Caja – Cobro Co-seguro</div>

    <!-- 1) Selección de paciente -->
    <div class="row g-2 align-items-end">
      <div class="col-12 col-md-6">
        <label class="form-label">Paciente</label>
        <select id="cx-paciente" class="form-select">
          <!-- se completa por JS -->
        </select>
      </div>
      <div class="col-12 col-md-3 d-grid">
        <label class="form-label">&nbsp;</label>
        <button id="cx-buscar-turnos" class="btn btn-dark">Ver turnos</button>
      </div>
    </div>

    <div class="rule-line"></div>

    <!-- 2) Turnos del paciente -->
    <div class="mb-2 fw-semibold">Turnos del paciente</div>
    <div id="cx-turnos" class="list-group mb-3">
      <div class="list-group-item muted">Seleccione un paciente y presione “Ver turnos”.</div>
    </div>

    <!-- 3) Detalle y cobro -->
    <div class="row g-2">
      <div class="col-12 col-lg-6">
        <div class="p-2 border rounded bg-white">
          <div class="fw-semibold mb-2">Detalle del turno seleccionado</div>
          <div class="row g-2">
            <div class="col-12 col-sm-4">
              <label class="form-label">Fecha/Hora</label>
              <input id="cx-turno" class="form-control" placeholder="--/-- --:--" readonly>
            </div>
            <div class="col-12 col-sm-4">
              <label class="form-label">Paciente</label>
              <input id="cx-paciente-nombre" class="form-control" placeholder="—" readonly>
            </div>
            <div class="col-12 col-sm-4">
              <label class="form-label">Médico</label>
              <input id="cx-medico" class="form-control" placeholder="—" readonly>
            </div>
            <div class="col-12 col-sm-6">
              <label class="form-label">Co-seguro</label>
              <div class="input-group">
                <span class="input-group-text">$</span>
                <input id="cx-monto" type="number" min="0" class="form-control mono-input" placeholder="0">
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Pago -->
      <div class="col-12 col-lg-6">
        <div class="p-2 border rounded bg-white">
          <div class="fw-semibold mb-2">Medio de pago</div>

          <div class="d-flex flex-wrap gap-3 mb-2">
            <div class="form-check">
              <input class="form-check-input" type="radio" name="cx-medio" id="cx-m-efectivo" value="Efectivo" checked>
              <label class="form-check-label" for="cx-m-efectivo">Efectivo</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="cx-medio" id="cx-m-transferencia" value="Transferencia">
              <label class="form-check-label" for="cx-m-transferencia">Transferencia</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="cx-medio" id="cx-m-qr" value="QR">
              <label class="form-check-label" for="cx-m-qr">QR</label>
            </div>
          </div>

          <!-- Campos dinámicos según medio -->
          <div id="cx-extra-efectivo" class="mb-2 mini muted">Sin datos extra.</div>

          <div id="cx-extra-transferencia" class="mb-2" style="display:none;">
            <div class="row g-2">
              <div class="col-sm-6">
                <label class="form-label">N° de operación</label>
                <input id="cx-op" class="form-control" placeholder="XXXXXXXX">
              </div>
              <div class="col-sm-6">
                <label class="form-label">Banco</label>
                <input id="cx-banco" class="form-control" placeholder="Banco X">
              </div>
            </div>
          </div>

          <div id="cx-extra-qr" class="mb-2" style="display:none;">
            <div class="d-grid gap-2">
              <button id="cx-generar-qr" class="btn btn-outline-dark btn-sm">Generar QR</button>
              <div id="cx-qr-box" class="border rounded p-3 text-center mini" style="display:none;">
                <div class="mb-2">[QR generado — simulado]</div>
                <div class="muted">Escaneado ✔️</div>
              </div>
            </div>
          </div>

          <div class="d-grid mt-2">
            <button id="btn-cobrar" class="btn btn-success" disabled>COBRAR (imprime)</button>
          </div>
        </div>
      </div>
    </div>

    <div id="cx-resumen" class="mini muted mt-3"></div>
  </div>
</section>


    <!-- D) Configurar Agenda -->
    <section class="tab-pane fade" id="config">
      <div class="lofi-card p-3">
        <div class="section-title mb-2">D) Configurar Agenda</div>

        <div class="row g-2">
          <div class="col-12 col-md-4">
            <label class="form-label">Médico</label>
            <select id="cfg-medico" class="form-select">
              <option selected>Dr. Pérez</option>
              <option>Dr. Sosa</option>
              <option>Dra. Gómez</option>
            </select>
          </div>
          <div class="col-12 col-md-3">
            <label class="form-label">Duración turno</label>
            <select id="cfg-duracion" class="form-select">
              <option>10 min</option>
              <option selected>15 min</option>
              <option>20 min</option>
              <option>30 min</option>
            </select>
          </div>
        </div>

        <div class="rule-line"></div>

        <div class="mb-2 fw-semibold">Reglas:</div>
        <div id="cfg-reglas" class="list-group mb-2">
          <label class="list-group-item d-flex align-items-center gap-2">
            <input class="form-check-input me-2" type="checkbox" checked>
            <span>Lun 09:00–13:00</span>
          </label>
        </div>
        <button id="btn-add-franja" class="btn btn-outline-dark btn-sm">+ Agregar franja</button>

        <div class="rule-line"></div>

        <div class="mb-2 fw-semibold">Excepciones:</div>
        <div id="cfg-excepciones" class="list-group mb-2"></div>
        <button id="btn-add-exc" class="btn btn-outline-dark btn-sm">+ Bloquear 25/11 10:00–11:00</button>

        <div class="rule-line"></div>

        <button id="btn-guardar-cfg" class="btn btn-dark">GUARDAR</button>
        <span id="cfg-msg" class="ms-2 mini muted"></span>
      </div>
    </section>

  </div>
</main>

<!-- Modal de Notas -->
<div class="modal fade" id="modalNotas" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content lofi-card">
      <div class="modal-header">
        <h5 class="modal-title">Notas del turno</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        <textarea id="nota-texto" class="form-control" rows="5" placeholder="Escribe notas..."></textarea>
      </div>
      <div class="modal-footer">
        <button class="btn btn-dark" data-bs-dismiss="modal">Guardar</button>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap JS (sin SRI) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
/** ========= Datos de ejemplo ========= **/
const turnosDisponibles = [
  {medico: "Dr. Pérez", esp: "Dermatología", fecha:"2025-11-18", dia:"Lun 18/11", slots:["09:00","09:30","10:00"]},
  {medico: "Dr. Sosa",  esp: "Dermatología", fecha:"2025-11-19", dia:"Mar 19/11", slots:["15:00","15:30"]},
  {medico: "Dra. Gómez",esp: "Clínica",      fecha:"2025-11-18", dia:"Lun 18/11", slots:["11:00","11:30"]}
];

const agendaEjemplo = [
  {hora:"09:00", paciente:"García, Ana", estado:"pendiente"},
  {hora:"09:30", paciente:"Rojas, Luis", estado:"pendiente"},
  {hora:"10:00", paciente:"Libre", estado:"libre"},
];

let slotSeleccionado = null;

/** ========= A) Buscar/Reservar ========= **/
const $res = document.getElementById('resultados');
const $btnBuscar = document.getElementById('btn-buscar');
const $btnIrResumen = document.getElementById('btn-ir-resumen');
const $btnConfirmar = document.getElementById('btn-confirmar');
const $resumen = document.getElementById('resumen');

function renderResultados(items) {
  $res.innerHTML = '';
  if (!items.length) {
    $res.innerHTML = '<div class="muted">Sin resultados para los filtros seleccionados.</div>';
    return;
  }
  items.forEach(it => {
    const row = document.createElement('div');
    row.className = 'p-2 border rounded';
    const slots = it.slots.map(h => `
      <button class="btn btn-outline-dark btn-sm slot-btn" data-medico="${it.medico}" data-esp="${it.esp}" data-dia="${it.dia}" data-hora="${h}">
        ${h} <span class="mini">[RESERVAR]</span>
      </button>`).join(' ');
    row.innerHTML = `
      <div class="d-flex flex-wrap align-items-center justify-content-between gap-2">
        <div>[${it.medico} - ${it.esp.replace('Dermatología','Dermato')}]  ${it.dia}:</div>
        <div class="d-flex flex-wrap gap-2">${slots}</div>
      </div>`;
    $res.appendChild(row);
  });

  // bind
  $res.querySelectorAll('.slot-btn').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      slotSeleccionado = {
        medico: btn.dataset.medico,
        esp: btn.dataset.esp,
        dia: btn.dataset.dia,
        hora: btn.dataset.hora
      };
      $btnIrResumen.disabled = false;
      $btnConfirmar.disabled = false;
      actualizarResumen();
    });
  });
}

function filtrar() {
  const esp = document.getElementById('f-especialidad').value;
  const med = document.getElementById('f-medico').value;
  const fdesde = document.getElementById('f-fecha').value;
  const out = turnosDisponibles.filter(t=>{
    const okEsp = !esp || t.esp===esp;
    const okMed = !med || t.medico===med;
    const okFecha = !fdesde || t.fecha >= fdesde;
    return okEsp && okMed && okFecha;
  });
  renderResultados(out);
}
$btnBuscar.addEventListener('click', filtrar);
renderResultados(turnosDisponibles);

function actualizarResumen() {
  const paciente = document.getElementById('paciente-nombre').value || '(sin datos)';
  const coseg = document.getElementById('coseguro-estimado').value || '____';
  if (!slotSeleccionado) { $resumen.textContent=''; return; }
  $resumen.innerHTML = `
    <div class="p-2 border rounded bg-white">
      <div class="fw-semibold">Resumen</div>
      Paciente: ${paciente}<br>
      Turno: ${slotSeleccionado.dia} ${slotSeleccionado.hora}<br>
      Médico: ${slotSeleccionado.medico} — ${slotSeleccionado.esp}<br>
      Co-seguro estimado: $${coseg}
    </div>`;
}
document.getElementById('paciente-nombre').addEventListener('input', actualizarResumen);
document.getElementById('coseguro-estimado').addEventListener('input', actualizarResumen);

$btnConfirmar.addEventListener('click', ()=>{
  if (!slotSeleccionado) return;
  alert('Reserva confirmada ✔️');
});

/** ========= B) Agenda del Médico ========= **/
const $agHeader = document.getElementById('ag-header');
const $agLista = document.getElementById('ag-lista');
const $kAt = document.getElementById('kpi-atendidos');
const $kAu = document.getElementById('kpi-ausentes');
const $kPe = document.getElementById('kpi-pendientes');

let agendaEstado = JSON.parse(JSON.stringify(agendaEjemplo)); // copia

function renderAgenda() {
  $agLista.innerHTML = '';
  agendaEstado.forEach((it, idx)=>{
    const item = document.createElement('div');
    item.className = 'list-group-item d-flex align-items-center justify-content-between';
    const btns = it.estado==='libre'
      ? `<button class="btn btn-outline-dark btn-sm" data-idx="${idx}" data-accion="agendar">[AGENDAR]</button>`
      : `<div class="d-flex gap-2">
           <button class="btn btn-dark btn-sm" data-idx="${idx}" data-accion="atender">[ATENDER]</button>
           <button class="btn btn-outline-dark btn-sm" data-idx="${idx}" data-accion="ausente">[AUSENTE]</button>
           <button class="btn btn-outline-secondary btn-sm" data-idx="${idx}" data-accion="notas">[Notas]</button>
         </div>`;
    item.innerHTML = `<div>${it.hora}&nbsp;&nbsp; ${it.paciente}</div>${btns}`;
    $agLista.appendChild(item);
  });

  // KPIs
  const atendidos = agendaEstado.filter(x=>x.estado==='atendido').length;
  const ausentes = agendaEstado.filter(x=>x.estado==='ausente').length;
  const pendientes = agendaEstado.filter(x=>x.estado==='pendiente').length;
  $kAt.textContent = atendidos;
  $kAu.textContent = ausentes;
  $kPe.textContent = pendientes;

  // binds
  $agLista.querySelectorAll('button').forEach(btn=>{
    const idx = +btn.dataset.idx;
    const acc = btn.dataset.accion;
    btn.addEventListener('click', ()=>{
      if (acc==='agendar') {
        agendaEstado[idx] = {hora: agendaEstado[idx].hora, paciente: '— Nuevo —', estado:'pendiente'};
      }
      if (acc==='atender') agendaEstado[idx].estado='atendido';
      if (acc==='ausente')  agendaEstado[idx].estado='ausente';
      if (acc==='notas') {
        const modal = new bootstrap.Modal(document.getElementById('modalNotas'));
        modal.show();
      }
      renderAgenda();
    });
  });
}
renderAgenda();

document.getElementById('btn-cargar-agenda').addEventListener('click', ()=>{
  const med = document.getElementById('ag-medico').value;
  const fecha = document.getElementById('ag-fecha').value || '2025-11-18';
  const d = new Date(fecha+'T00:00:00');
  const dia = d.toLocaleDateString('es-AR',{weekday:"short", day:"2-digit", month:"2-digit"}).replace('.', '');
  $agHeader.textContent = `${med} (${dia}) — Consultorio 2`;
  agendaEstado = JSON.parse(JSON.stringify(agendaEjemplo));
  renderAgenda();
});

/** ========= C) Caja ========= **/
document.getElementById('btn-cobrar').addEventListener('click', ()=>{
  const t = document.getElementById('cx-turno').value || '18/11 09:00';
  const p = document.getElementById('cx-paciente').value || 'García, Ana';
  const m = document.getElementById('cx-medico').value || 'Dr. Pérez';
  const monto = document.getElementById('cx-monto').value || '____';
  const medio = document.getElementById('cx-medio').value;

  const resumen = `Comprobante
----------------------------
Turno: ${t}
Paciente: ${p}
Médico: ${m}
Co-seguro: $${monto}
Medio: ${medio}`;
  document.getElementById('cx-resumen').innerText = resumen;
  window.print(); // simula impresión
});

/** ========= D) Configurar Agenda ========= **/
document.getElementById('btn-add-franja').addEventListener('click', ()=>{
  const cont = document.getElementById('cfg-reglas');
  const li = document.createElement('label');
  li.className='list-group-item d-flex align-items-center gap-2';
  li.innerHTML = `<input class="form-check-input me-2" type="checkbox" checked>
                  <span>Mié 15:00–18:00</span>`;
  cont.appendChild(li);
});

document.getElementById('btn-add-exc').addEventListener('click', ()=>{
  const cont = document.getElementById('cfg-excepciones');
  const li = document.createElement('div');
  li.className='list-group-item d-flex align-items-center justify-content-between';
  li.innerHTML = `<span>Bloqueo — 25/11 10:00–11:00</span>
                  <button class="btn btn-outline-danger btn-sm">Quitar</button>`;
  li.querySelector('button').addEventListener('click', ()=> li.remove());
  cont.appendChild(li);
});

document.getElementById('btn-guardar-cfg').addEventListener('click', ()=>{
  const msg = document.getElementById('cfg-msg');
  msg.textContent = 'Configuración guardada ✔️';
  setTimeout(()=> msg.textContent='', 2000);
});

// ======= Datos de ejemplo: pacientes y turnos =======
const pacientesData = [
  {
    id: 1, nombre: "García, Ana",
    turnos: [
      { id: 101, fecha: "2025-11-18", hora: "09:00", medico: "Dr. Pérez", especialidad: "Dermatología", coseguro: 3500, estado: "pendiente" },
      { id: 102, fecha: "2025-11-25", hora: "10:30", medico: "Dra. Gómez", especialidad: "Clínica", coseguro: 3000, estado: "pendiente" }
    ]
  },
  {
    id: 2, nombre: "Rojas, Luis",
    turnos: [
      { id: 201, fecha: "2025-11-18", hora: "09:30", medico: "Dr. Pérez", especialidad: "Dermatología", coseguro: 3500, estado: "pendiente" }
    ]
  },
  {
    id: 3, nombre: "Paz, Carla",
    turnos: [
      { id: 301, fecha: "2025-11-19", hora: "15:00", medico: "Dr. Sosa", especialidad: "Dermatología", coseguro: 3200, estado: "pendiente" },
      { id: 302, fecha: "2025-11-19", hora: "15:30", medico: "Dr. Sosa", especialidad: "Dermatología", coseguro: 3200, estado: "pendiente" }
    ]
  }
];

let cxTurnoSeleccionado = null; // {paciente, turno}

// ==== Helpers de UI (Caja) ====
const el = id => document.getElementById(id);

// Completar combo de pacientes al cargar
(function initCajaPacientes(){
  const $sel = el('cx-paciente');
  if (!$sel) return; // por si no estás en la pestaña
  $sel.innerHTML = pacientesData.map(p => `<option value="${p.id}">${p.nombre}</option>`).join('');
})();

// Buscar y listar turnos del paciente elegido
el('cx-buscar-turnos')?.addEventListener('click', ()=>{
  const id = parseInt(el('cx-paciente').value, 10);
  const paciente = pacientesData.find(p=>p.id===id);
  const $list = el('cx-turnos');
  $list.innerHTML = '';
  if (!paciente || paciente.turnos.length===0){
    $list.innerHTML = `<div class="list-group-item muted">No hay turnos para este paciente.</div>`;
    return;
  }

  paciente.turnos.forEach(t=>{
    const li = document.createElement('div');
    li.className = 'list-group-item d-flex align-items-center justify-content-between';
    li.innerHTML = `
      <div>
        <div><strong>${t.fecha} ${t.hora}</strong> — ${t.medico} <span class="mini muted">(${t.especialidad})</span></div>
        <div class="mini muted">Co-seguro sugerido: $${t.coseguro}</div>
      </div>
      <button class="btn btn-outline-dark btn-sm">Seleccionar</button>
    `;
    li.querySelector('button').addEventListener('click', ()=>{
      cxTurnoSeleccionado = { paciente, turno: t };
      // Completar detalle
      el('cx-turno').value = `${t.fecha.slice(8,10)}/${t.fecha.slice(5,7)} ${t.hora}`;
      el('cx-paciente-nombre').value = paciente.nombre;
      el('cx-medico').value = t.medico;
      el('cx-monto').value = t.coseguro;

      // Habilitar COBRAR
      el('btn-cobrar').disabled = false;

      // Feedback visual
      [...$list.querySelectorAll('.list-group-item')].forEach(x=>x.classList.remove('active'));
      li.classList.add('active');
    });

    $list.appendChild(li);
  });
});

// Radios de pago: mostrar campos extra
const $extraEfe = el('cx-extra-efectivo');
const $extraTrf = el('cx-extra-transferencia');
const $extraQR  = el('cx-extra-qr');

function switchMedioPago(){
  const medio = document.querySelector('input[name="cx-medio"]:checked')?.value;
  if (!medio) return;
  $extraEfe.style.display = (medio==='Efectivo') ? '' : 'none';
  $extraTrf.style.display = (medio==='Transferencia') ? '' : 'none';
  $extraQR.style.display  = (medio==='QR') ? '' : 'none';
}
document.querySelectorAll('input[name="cx-medio"]').forEach(r=>{
  r.addEventListener('change', switchMedioPago);
});
switchMedioPago();

// Generar QR (simulado)
el('cx-generar-qr')?.addEventListener('click', ()=>{
  el('cx-qr-box').style.display = '';
});

// COBRAR
el('btn-cobrar')?.addEventListener('click', ()=>{
  if (!cxTurnoSeleccionado){
    alert('Seleccioná un turno.');
    return;
  }
  const { paciente, turno } = cxTurnoSeleccionado;
  const monto = el('cx-monto').value || '0';
  const medio = document.querySelector('input[name="cx-medio"]:checked')?.value || 'Efectivo';

  // Validaciones simples según medio
  if (medio==='Transferencia'){
    if (!el('cx-op').value) return alert('Ingresá el N° de operación.');
    if (!el('cx-banco').value) return alert('Ingresá el banco.');
  }
  if (medio==='QR'){
    // En la vida real verificaríamos callback de pago
    if (el('cx-qr-box').style.display==='none') return alert('Generá/valida el QR antes de cobrar.');
  }

  const resumen = `Comprobante
----------------------------
Turno: ${turno.fecha.slice(8,10)}/${turno.fecha.slice(5,7)} ${turno.hora}
Paciente: ${paciente.nombre}
Médico: ${turno.medico}
Co-seguro: $${monto}
Medio: ${medio}${medio==='Transferencia' ? ` (Op: ${el('cx-op').value}, Banco: ${el('cx-banco').value})` : ''}`;

  el('cx-resumen').innerText = resumen;
  window.print(); // simula impresión
});

</script>

</body>
</html>
