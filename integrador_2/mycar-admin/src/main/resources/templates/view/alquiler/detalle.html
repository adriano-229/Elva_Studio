<!DOCTYPE html>
<html data-pc-direction="ltr" data-pc-preset="preset-1" data-pc-sidebar-caption="true"
      data-pc-theme="light" dir="ltr" lang="es"
      xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui" name="viewport">
  <title>Detalle de Alquiler | MyCar Admin</title>

  <link id="main-style-link" rel="stylesheet" th:href="@{/assets/css/style.css}"/>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
      body {
          background-color: #f3f4f6;
          font-family: 'Open Sans', sans-serif;
      }

      .page-header {
          background: #f9fafb; /* gris claro */
          border-radius: 10px;
          padding: 25px 30px;
          color: #111827; /* texto oscuro */
          box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
          border: 1px solid #e5e7eb; /* línea sutil */
      }


      .page-header h5 {
          font-weight: 600;
          margin-bottom: 5px;
      }

      .page-header .breadcrumb-item a {
          color: #cbd5e1;
      }

      .page-header .breadcrumb-item.active {
          color: #fff;
      }

      .card {
          border: none;
          border-radius: 10px;
          background: #fff;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
          transition: all 0.2s ease-in-out;
      }

      .card:hover {
          transform: translateY(-2px);
          box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
      }

      .card-header {
          border: none;
          border-radius: 10px 10px 0 0;
          font-weight: 600;
          font-size: 16px;
      }

      .bg-gradient-primary {
          background: linear-gradient(90deg, #2563eb, #1e3a8a);
          color: white;
      }

      .bg-gradient-success {
          background: linear-gradient(90deg, #16a34a, #065f46);
          color: white;
      }

      .bg-gradient-warning {
          background: linear-gradient(90deg, #f59e0b, #b45309);
          color: white;
      }

      .list-group-item {
          border: none;
          padding: 10px 15px;
          border-bottom: 1px solid #eee;
      }

      .list-group-item:last-child {
          border-bottom: none;
      }

      .btn {
          border-radius: 6px;
          font-weight: 500;
      }

      .btn-primary {
          background-color: #2563eb;
          border: none;
      }

      .btn-primary:hover {
          background-color: #1e40af;
      }

      .btn-warning {
          background-color: #f59e0b;
          border: none;
          color: #fff;
      }

      .btn-warning:hover {
          background-color: #d97706;
      }

      .alert {
          border-radius: 8px;
          padding: 15px 20px;
          font-weight: 500;
      }

      .alert-success {
          background-color: #dcfce7;
          color: #15803d;
      }

      .alert-danger {
          background-color: #fee2e2;
          color: #b91c1c;
      }

      .info-icon {
          font-size: 40px;
          color: #2563eb;
          opacity: 0.8;
      }

      .label-muted {
          color: #6b7280;
          font-size: 14px;
      }

      .form-label {
          font-weight: 500;
      }

      @media (max-width: 992px) {
          .grid {
              display: block !important;
          }
      }

      .vehicle-image-container {
          width: 100%;
          height: 200px;
          overflow: hidden;
          border-bottom: 1px solid #eee;
          background-color: #f8fafc; /* tono suave de fondo */
      }

      .vehicle-image {
          width: 100%;
          height: 100%;
          object-fit: cover;
          transition: transform 0.3s ease-in-out;
      }

      .vehicle-image:hover {
          transform: scale(1.05);
      }
  </style>
</head>

<body>

<!-- Sidebar -->
<div th:replace="fragments/layout :: sidebar"></div>

<!-- Header -->
<div th:replace="fragments/layout :: header"></div>

<!-- Main -->
<div class="pc-container">
  <div class="pc-content">

    <!-- Header con breadcrumb -->
    <div class="page-header">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h5>Detalle del Alquiler</h5>
          <!--<ul class="breadcrumb mb-0">
              <li class="breadcrumb-item"><a th:href="@{/dashboard}">Inicio</a></li>
              <li class="breadcrumb-item"><a th:href="@{/alquiler/listar}">Alquileres</a></li>
              <li class="breadcrumb-item active">Detalle</li>-->
          </ul>
        </div>
        <!--<a th:href="@{/alquiler/listar}" class="btn btn-light text-dark">
            <i class="ti ti-arrow-left"></i> Volver
        </a>-->
      </div>
    </div>

    <!-- Mensajes -->
    <div class="mt-4" th:if="${msgExito != null}">
      <div class="alert alert-success shadow-sm" role="alert">
        <i class="ti ti-check me-2"></i>
        <span th:text="${msgExito}">Operación exitosa.</span>
      </div>
    </div>
    <div class="mt-4" th:if="${msgError != null}">
      <div class="alert alert-danger shadow-sm" role="alert">
        <i class="ti ti-alert-triangle me-2"></i>
        <span th:text="${msgError}">Ocurrió un error al procesar la solicitud.</span>
      </div>
    </div>

    <!-- Contenido principal -->
    <div class="grid grid-cols-12 gap-6 mt-4">

      <!-- Cliente -->
      <div class="col-span-12 xl:col-span-4 md:col-span-6">
        <div class="card h-100">
          <div class="card-header bg-gradient-primary">
            <i class="ti ti-user me-2"></i> Datos del Cliente
          </div>
          <div class="card-body">
            <ul class="list-group list-group-flush">
              <li class="list-group-item">
                <strong>Nombre:</strong>
                <span th:text="${alquiler.cliente.nombre + ' ' + alquiler.cliente.apellido}">Juan Pérez</span>
              </li>
              <li class="list-group-item">
                <strong>DNI:</strong>
                <span th:text="${alquiler.cliente.numeroDocumento}">12345678</span>
              </li>
              <li class="list-group-item">
                <strong>Dirección:</strong>
                <span th:text="${alquiler.cliente.direccionEstadia}">Calle Falsa 123</span>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Vehículo -->
      <div class="col-span-12 xl:col-span-4 md:col-span-6">
        <div class="card h-100 overflow-hidden">
          <div class="card-header bg-gradient-success">
            <i class="ti ti-car me-2"></i> Vehículo
          </div>

          <!-- Imagen del vehículo -->
          <div class="vehicle-image-container">
            <img alt="Vehículo"
                 class="vehicle-image"
                 th:src="@{${alquiler.vehiculo.caracteristicaVehiculo.imagen}}">
          </div>

          <!-- Información -->
          <div class="card-body text-center">
            <h5 class="mb-1"
                th:text="${alquiler.vehiculo.caracteristicaVehiculo.marca + ' ' + alquiler.vehiculo.caracteristicaVehiculo.modelo}"></h5>
            <p class="label-muted mb-3" th:text="'Patente: ' + ${alquiler.vehiculo.patente}"></p>
            <div class="d-flex justify-content-between px-3">
              <span><strong>Puertas:</strong> <span
                  th:text="${alquiler.vehiculo.caracteristicaVehiculo.cantidadPuerta}">4</span></span>
              <span><strong>Asientos:</strong> <span
                  th:text="${alquiler.vehiculo.caracteristicaVehiculo.cantidadAsiento}">5</span></span>
              <span><strong>Año:</strong> <span
                  th:text="${alquiler.vehiculo.caracteristicaVehiculo.anio}">2023</span></span>
            </div>
          </div>
        </div>
      </div>


      <!-- Fechas y Costo -->
      <div class="col-span-12 xl:col-span-4 md:col-span-6">
        <div class="card h-100">
          <div class="card-header bg-gradient-warning d-flex justify-content-between align-items-center">
            <div><i class="ti ti-calendar me-2"></i> Fechas y Costo</div>
            <button class="btn btn-light btn-sm text-dark" id="btnEditar" onclick="mostrarFormularioEdicion()"
                    type="button">
              <i class="ti ti-edit me-1"></i>Editar
            </button>
          </div>

          <!-- Vista informativa -->
          <div class="card-body" id="vistaInfo">
            <ul class="list-group list-group-flush">
              <li class="list-group-item">
                <strong>Fecha Desde:</strong>
                <span th:text="${#temporals.format(alquiler.fechaDesde, 'dd/MM/yyyy')}">01/11/2025</span>
              </li>
              <li class="list-group-item">
                <strong>Fecha Hasta:</strong>
                <span th:text="${#temporals.format(alquiler.fechaHasta, 'dd/MM/yyyy')}">07/11/2025</span>
              </li>
              <li class="list-group-item">
                <strong>Cantidad de Días:</strong>
                <span th:text="${alquiler.cantidadDias}">7</span>
              </li>
              <li class="list-group-item">
                <strong>Costo Total:</strong>
                $<span th:text="${alquiler.costoCalculado}">150000</span>
              </li>
            </ul>
          </div>

          <!-- Formulario de edición -->
          <div class="card-body" id="formEdicion" style="display:none;">
            <form method="post" th:action="@{/alquiler/actualizarFechas}" th:object="${alquiler}">
              <input th:field="*{id}" type="hidden">
              <div class="mb-3">
                <label class="form-label fw-semibold">Fecha Desde</label>
                <input class="form-control" id="fechaDesdeInput" th:field="*{fechaDesde}" type="date">
              </div>
              <div class="mb-3">
                <label class="form-label fw-semibold">Fecha Hasta</label>
                <input class="form-control" id="fechaHastaInput" th:field="*{fechaHasta}" type="date">
              </div>
              <div class="mb-3">
                <label class="form-label fw-semibold">Cantidad de Días</label>
                <input class="form-control" id="diasInput" readonly th:value="${alquiler.cantidadDias}" type="text">
              </div>
              <div class="mb-3">
                <label class="form-label fw-semibold">Costo Calculado</label>
                <div class="input-group">
                  <span class="input-group-text">$</span>
                  <input class="form-control" id="costoInput" readonly th:value="${alquiler.costoCalculado}"
                         type="text">
                </div>
              </div>
              <div class="d-flex gap-2">
                <button class="btn btn-primary w-50" type="submit">
                  <i class="ti ti-device-floppy me-1"></i>Guardar
                </button>
                <button class="btn btn-secondary w-50" onclick="cancelarEdicion()" type="button">
                  <i class="ti ti-x me-1"></i>Cancelar
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Documentación -->
      <div class="col-span-12 mt-6">
        <div class="card">
          <div class="card-header bg-gradient-primary">
            <i class="ti ti-file-description me-2"></i> Documentación del Alquiler
          </div>
          <div class="card-body">
            <form enctype="multipart/form-data" method="post" th:action="@{/alquiler/actualizarDocumentacion}"
                  th:object="${alquiler.documentacion}">
              <input name="alquilerId" th:value="${alquiler.id}" type="hidden">
              <div class="grid grid-cols-12 gap-4">
                <div class="col-span-12 md:col-span-4">
                  <label class="form-label">Tipo de Documentación</label>
                  <select class="form-select" th:field="*{tipoDocumentacion}">
                    <option value="">Seleccione...</option>
                    <option th:each="tipo : ${T(com.example.mycar.mycar_admin.domain.enums.TipoDocumentacion).values()}"
                            th:text="${tipo}" th:value="${tipo}"></option>
                  </select>
                </div>
                <div class="col-span-12 md:col-span-4">
                  <label class="form-label">Observación</label>
                  <input class="form-control" placeholder="Escriba una observación..." th:field="*{observacion}"
                         type="text">
                </div>
                <div class="col-span-12 md:col-span-4">
                  <label class="form-label">Archivo PDF</label>
                  <input accept=".pdf" class="form-control" th:field="*{pdf}" type="file">
                  <div class="mt-2" th:if="${alquiler.documentacion.pathArchivo != null}">
                    <a class="btn btn-outline-primary btn-sm" target="_blank"
                       th:href="@{${alquiler.documentacion.pathArchivo}}">
                      <i class="ti ti-file"></i> Ver PDF actual
                    </a>
                  </div>
                </div>
              </div>
              <div class="text-end mt-4">
                <button class="btn btn-warning" type="submit">
                  <i class="ti ti-refresh me-2"></i>Actualizar Documentación
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

  </div>

  <div th:replace="fragments/layout :: footer"></div>

  <script th:src="@{/assets/js/plugins/simplebar.min.js}"></script>
  <script th:src="@{/assets/js/plugins/popper.min.js}"></script>
  <script th:src="@{/assets/js/plugins/feather.min.js}"></script>
  <script th:src="@{/assets/js/component.js}"></script>
  <script th:src="@{/assets/js/theme.js}"></script>
  <script th:src="@{/assets/js/script.js}"></script>
  <script>
      // Simular costo diario recibido desde el backend
      const costoPorDia = /*[[${alquiler.vehiculo.caracteristicaVehiculo.costoVehiculo.costo}]]*/ 0;

      function mostrarFormularioEdicion() {
          document.getElementById("vistaInfo").style.display = "none";
          document.getElementById("formEdicion").style.display = "block";
          document.getElementById("btnEditar").style.display = "none";

          const desde = document.getElementById("fechaDesdeInput");
          const hasta = document.getElementById("fechaHastaInput");

          desde.addEventListener("change", recalcular);
          hasta.addEventListener("change", recalcular);
      }

      function cancelarEdicion() {
          document.getElementById("vistaInfo").style.display = "block";
          document.getElementById("formEdicion").style.display = "none";
          document.getElementById("btnEditar").style.display = "inline-block";
      }

      function recalcular() {
          const desde = new Date(document.getElementById("fechaDesdeInput").value);
          const hasta = new Date(document.getElementById("fechaHastaInput").value);
          const diasInput = document.getElementById("diasInput");
          const costoInput = document.getElementById("costoInput");

          if (isNaN(desde) || isNaN(hasta) || hasta < desde) {
              diasInput.value = "";
              costoInput.value = "";
              return;
          }

          const diffTime = Math.abs(hasta - desde);
          const dias = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
          diasInput.value = dias;
          costoInput.value = (dias * costoPorDia).toFixed(2);
      }
  </script>
</body>
</html>
